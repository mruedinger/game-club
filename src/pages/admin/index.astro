---
import AppHeader from "../../components/AppHeader.astro";
import AppFooter from "../../components/AppFooter.astro";
import "../../styles/base.css";

export const prerender = false;
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Game Club | Admin</title>
	</head>
	<body>
		<AppHeader />

		<main class="admin-shell is-hidden">
			<div class="container">
				<section class="hero">
					<div class="hero-text">
						<p class="eyebrow">Admin</p>
						<h1>Control Room</h1>
						<p class="muted">Manage members, content, and club operations.</p>
					</div>
				</section>

				<section class="section card members-card">
					<div class="section-head">
						<h2>Members</h2>
						<p class="muted">View and manage member access.</p>
					</div>
					<button class="cta invite-cta" type="button" data-action="open-invite">
						Add a new member
					</button>
					<div class="table-wrapper scroll-rows" aria-live="polite">
						<table class="games-table member-table">
							<thead>
								<tr>
									<th>User</th>
									<th>Alias</th>
									<th>Email</th>
									<th>Role</th>
								</tr>
							</thead>
							<tbody class="member-list">
								<tr>
									<td class="muted small" colspan="4">Loading members…</td>
								</tr>
							</tbody>
						</table>
					</div>
				</section>

				<section class="section card games-editor">
					<div class="section-head">
						<h2>Games data editor</h2>
						<p class="muted">Edit submitters, status, tags, and timing details.</p>
					</div>
					<p class="muted small">Tags: comma-separated list (e.g. Narrative, Roguelike, Puzzle)</p>
					<div class="table-wrapper scroll-rows">
						<table class="games-table games-editor-table">
							<thead>
								<tr>
									<th data-sort="title" class="sortable">Title</th>
									<th data-sort="submitter" class="sortable">Submitter</th>
									<th data-sort="status" class="sortable">Status</th>
									<th data-sort="tags" class="sortable">Tags</th>
									<th data-sort="ttb" class="sortable">Time to beat</th>
									<th data-sort="played" class="sortable">Played month</th>
								</tr>
							</thead>
							<tbody class="games-editor-body">
								<tr>
									<td class="muted small" colspan="6">Loading games…</td>
								</tr>
							</tbody>
						</table>
					</div>
				</section>

				<section class="section card audit-card">
					<div class="section-head">
						<h2>Audit logs</h2>
						<p class="muted">Track recent administrative activity.</p>
					</div>
					<div class="table-wrapper scroll-rows">
						<table class="games-table audit-table">
							<thead>
								<tr>
									<th>When</th>
									<th>Actor</th>
									<th>Action</th>
									<th>Entity</th>
								</tr>
							</thead>
							<tbody class="audit-body">
								<tr>
									<td class="muted small" colspan="4">Loading activity…</td>
								</tr>
							</tbody>
						</table>
					</div>
				</section>
			</div>
		</main>
		<AppFooter />

		<dialog class="modal" id="invite-modal">
			<form method="dialog" class="modal-card invite-form" novalidate>
				<header>
					<h3>Add a new member</h3>
					<button class="ghost icon-button" type="button" data-action="close-invite" aria-label="Close">
						×
					</button>
				</header>
				<div class="field">
					<label for="invite-email">Email</label>
					<input id="invite-email" name="email" type="email" placeholder="name@example.com" required />
				</div>
				<div class="field">
					<label for="invite-role">Role</label>
					<select id="invite-role" name="role" required>
						<option value="member" selected>Member</option>
						<option value="admin">Admin</option>
					</select>
				</div>
				<footer>
					<button class="ghost" value="cancel" type="button" data-action="close-invite">Cancel</button>
					<button class="cta" type="submit">Submit</button>
				</footer>
			</form>
		</dialog>

		<dialog class="modal" id="member-modal">
			<form class="modal-card member-detail" novalidate>
				<header>
					<div>
						<h3 id="member-name">Member</h3>
						<p class="muted small" id="member-email">email@example.com</p>
					</div>
					<button class="ghost icon-button" type="button" data-action="close-member" aria-label="Close">
						×
					</button>
				</header>
				<div class="field">
					<label for="edit-role">Role</label>
					<select id="edit-role" name="role" required>
						<option value="member">Member</option>
						<option value="admin">Admin</option>
					</select>
				</div>
				<div class="field">
					<label for="edit-alias">Alias</label>
					<input id="edit-alias" name="alias" type="text" placeholder="Optional" />
				</div>
				<div class="actions">
					<button class="ghost danger small-button" data-action="delete" type="button">Delete member</button>
				</div>
				<footer>
					<button class="ghost" type="button" data-action="close-member">Cancel</button>
					<button class="cta" type="submit">Submit</button>
				</footer>
			</form>
		</dialog>

		<dialog class="modal" id="game-modal">
			<form class="modal-card game-detail" novalidate>
				<header>
					<div>
						<h3 id="game-modal-title">Game</h3>
						<p class="muted small" id="game-modal-subtitle"></p>
					</div>
					<button class="ghost icon-button" type="button" data-action="close-game" aria-label="Close">
						×
					</button>
				</header>
				<div class="field">
					<label for="edit-game-submitter">Submitter</label>
					<select id="edit-game-submitter" name="submitted_by_email" required></select>
				</div>
				<div class="field">
					<label for="edit-game-status">Status</label>
					<select id="edit-game-status" name="status" required>
						<option value="backlog">backlog</option>
						<option value="current">current</option>
						<option value="played">played</option>
					</select>
				</div>
				<div class="field">
					<label for="edit-game-tags">Tags</label>
					<input id="edit-game-tags" name="tags" type="text" placeholder="Narrative, Roguelike" />
				</div>
				<div class="field">
					<label for="edit-game-ttb">Time to beat (hours)</label>
					<input id="edit-game-ttb" name="time_to_beat_hours" type="number" step="0.5" min="0" />
				</div>
				<div class="field">
					<label for="edit-game-played">Played month</label>
					<input id="edit-game-played" name="played_month" type="month" />
				</div>
				<p class="form-error hidden" id="game-modal-error" role="alert"></p>
				<footer>
					<button class="ghost" type="button" data-action="close-game">Cancel</button>
					<button class="cta" type="submit">Save</button>
				</footer>
			</form>
		</dialog>

		<script>
			const shell = document.querySelector(".admin-shell");
			const inviteForm = document.querySelector("#invite-modal .invite-form");
			const memberList = document.querySelector(".member-list");
			const gamesBody = document.querySelector(".games-editor-body");
			const auditBody = document.querySelector(".audit-body");
			const gameModal = document.querySelector("#game-modal");
			const gameModalTitle = document.querySelector("#game-modal-title");
			const gameModalSubtitle = document.querySelector("#game-modal-subtitle");
			const gameModalError = document.querySelector("#game-modal-error");
			const gameSubmitter = document.querySelector("#edit-game-submitter");
			const gameStatus = document.querySelector("#edit-game-status");
			const gameTags = document.querySelector("#edit-game-tags");
			const gameTtb = document.querySelector("#edit-game-ttb");
			const gamePlayed = document.querySelector("#edit-game-played");
			const gameSortHeaders = document.querySelectorAll(".games-editor-table th[data-sort]");
			const inviteModal = document.querySelector("#invite-modal");
			const memberModal = document.querySelector("#member-modal");
			const memberName = document.querySelector("#member-name");
			const memberEmail = document.querySelector("#member-email");
			const editRole = document.querySelector("#edit-role");
			const editAlias = document.querySelector("#edit-alias");
			let activeMember = null;
			let activeGameId = null;
			let cachedMembers = [];
			let cachedGames = [];

			let currentUserEmail = null;

			fetch("/api/admin/summary")
				.then((response) => {
					if (response.status === 401) {
						window.location.href = "/api/auth/login";
						throw new Error("Unauthorized");
					}
					if (response.status === 403) {
						window.location.href = "/auth/denied";
						throw new Error("Forbidden");
					}
					return response.json();
				})
				.then((data) => {
					currentUserEmail = data?.me?.email || null;
					if (shell) shell.classList.remove("is-hidden");
					renderMembers(data?.members || []);
					loadGames();
					loadAuditLogs();
				})
				.catch(() => {});

			function renderMembers(members) {
				if (!memberList) return;
				if (!members || members.length === 0) {
					memberList.innerHTML = '<tr><td class="muted small" colspan="4">No members yet.</td></tr>';
					return;
				}

				cachedMembers = members;
				memberList.innerHTML = "";
				const toastRow = document.createElement("tr");
				const toastCell = document.createElement("td");
				toastCell.colSpan = 4;
				const toast = document.createElement("div");
				toast.className = "toast";
				toast.setAttribute("aria-live", "polite");
				toastCell.appendChild(toast);
				toastRow.appendChild(toastCell);
				memberList.appendChild(toastRow);
				members.forEach((member) => {
					const row = document.createElement("tr");
					row.className = "clickable-row";
					row.dataset.email = member.email;

					const userCell = document.createElement("td");
					const userWrap = document.createElement("div");
					userWrap.className = "member-user";
					const avatar = document.createElement("div");
					avatar.className = "avatar";
					if (member.picture) {
						const img = document.createElement("img");
						img.className = "avatar-img";
						img.src = member.picture;
						img.alt = "";
						img.referrerPolicy = "no-referrer";
						img.decoding = "async";
						avatar.appendChild(img);
					} else {
						const fallback = document.createElement("span");
						fallback.className = "avatar-fallback";
						fallback.textContent = (member.name || member.email)
							.charAt(0)
							.toUpperCase();
						avatar.appendChild(fallback);
					}

					const name = document.createElement("div");
					name.className = "member-name";
					name.textContent = member.name || "—";
					userWrap.appendChild(avatar);
					userWrap.appendChild(name);
					userCell.appendChild(userWrap);

					const aliasCell = document.createElement("td");
					aliasCell.textContent = member.alias || "—";

					const emailCell = document.createElement("td");
					emailCell.className = "member-email";
					emailCell.textContent = member.email;

					const roleCell = document.createElement("td");
					roleCell.textContent = member.role === "admin" ? "Admin" : "Member";

					row.appendChild(userCell);
					row.appendChild(aliasCell);
					row.appendChild(emailCell);
					row.appendChild(roleCell);
					memberList.appendChild(row);
				});
			}

			async function loadGames() {
				if (!gamesBody) return;
				gamesBody.innerHTML = '<tr><td class="muted small" colspan="6">Loading games…</td></tr>';
				const response = await fetch("/api/admin/games");
				if (!response.ok) {
					gamesBody.innerHTML = '<tr><td class="muted small" colspan="6">Unable to load games.</td></tr>';
					return;
				}
				const games = await response.json();
				cachedGames = games || [];
				renderGames(cachedGames);
			}

			async function loadAuditLogs() {
				if (!auditBody) return;
				auditBody.innerHTML = '<tr><td class="muted small" colspan="4">Loading activity…</td></tr>';
				const response = await fetch("/api/admin/audit-logs");
				if (!response.ok) {
					auditBody.innerHTML = '<tr><td class="muted small" colspan="4">Unable to load audit logs.</td></tr>';
					return;
				}
				const logs = await response.json();
				renderAuditLogs(logs || []);
			}

			function renderAuditLogs(logs) {
				if (!auditBody) return;
				if (!logs || logs.length === 0) {
					auditBody.innerHTML = '<tr><td class="muted small" colspan="4">No audit activity yet.</td></tr>';
					return;
				}
				auditBody.innerHTML = "";
				logs.forEach((entry) => {
					const row = document.createElement("tr");

					const whenCell = document.createElement("td");
					whenCell.textContent = entry.created_at;

					const actorCell = document.createElement("td");
					actorCell.textContent = entry.actor_email;

					const actionCell = document.createElement("td");
					actionCell.textContent = entry.action;

					const entityCell = document.createElement("td");
					entityCell.textContent = entry.entity_id
						? `${entry.entity_type} #${entry.entity_id}`
						: entry.entity_type;

					row.appendChild(whenCell);
					row.appendChild(actorCell);
					row.appendChild(actionCell);
					row.appendChild(entityCell);
					auditBody.appendChild(row);
				});
			}

			function renderGames(games) {
				if (!gamesBody) return;
				if (!games || games.length === 0) {
					gamesBody.innerHTML = '<tr><td class="muted small" colspan="6">No games yet.</td></tr>';
					return;
				}
				gamesBody.innerHTML = "";
				games.forEach((game) => {
					const row = document.createElement("tr");
					const tags = parseTags(game.tags_json);
					row.dataset.id = game.id;
					row.dataset.title = game.title.toLowerCase();
					row.dataset.submitter = game.submitted_by_email || "";
					row.dataset.status = game.status || "";
					row.dataset.tags = tags.join(", ");
					row.dataset.ttb = typeof game.time_to_beat_minutes === "number" ? String(game.time_to_beat_minutes) : "";
					row.dataset.played = game.played_month || "";
					row.className = "clickable-row";

					const titleCell = document.createElement("td");
					titleCell.textContent = game.title;

					const submitterCell = document.createElement("td");
					submitterCell.textContent = getMemberLabel(game.submitted_by_email);

					const statusCell = document.createElement("td");
					statusCell.textContent = game.status;

					const tagsCell = document.createElement("td");
					tagsCell.textContent = tags.length > 0 ? tags.join(", ") : "-";

					const ttbCell = document.createElement("td");
					ttbCell.textContent = formatHours(game.time_to_beat_minutes);

					const playedCell = document.createElement("td");
					playedCell.textContent = game.played_month || "-";

					row.appendChild(titleCell);
					row.appendChild(submitterCell);
					row.appendChild(statusCell);
					row.appendChild(tagsCell);
					row.appendChild(ttbCell);
					row.appendChild(playedCell);
					gamesBody.appendChild(row);
				});
				sortGameRows("title", "asc");
			}

			function getMemberLabel(email) {
				const match = cachedMembers.find((member) => member.email === email);
				if (!match) return email;
				return match.alias || match.name || match.email;
			}

			function parseTags(tagsJson) {
				if (!tagsJson) return [];
				try {
					const parsed = JSON.parse(tagsJson);
					return Array.isArray(parsed) ? parsed : [];
				} catch {
					return [];
				}
			}

			function formatHours(minutes) {
				if (typeof minutes !== "number") return "-";
				return (minutes / 60).toFixed(1);
			}

			if (gamesBody) {
				gamesBody.addEventListener("click", (event) => {
					const target = event.target;
					if (!(target instanceof HTMLElement)) return;
					const row = target.closest(".clickable-row");
					if (!row) return;
					const id = Number.parseInt(row.dataset.id || "", 10);
					const game = cachedGames.find((item) => item.id === id);
					if (!game) return;
					openGameModal(game);
				});
			}

			function openGameModal(game) {
				if (!gameModal || !gameSubmitter || !gameStatus || !gameTags || !gameTtb || !gamePlayed) {
					return;
				}
				activeGameId = game.id;
				gameModalTitle.textContent = game.title;
				gameModalSubtitle.textContent = game.submitted_by_email;
				gameSubmitter.innerHTML = "";
				cachedMembers.forEach((member) => {
					const option = document.createElement("option");
					option.value = member.email;
					option.textContent = member.alias || member.name || member.email;
					if (member.email === game.submitted_by_email) option.selected = true;
					gameSubmitter.appendChild(option);
				});
				gameStatus.value = game.status;
				gameTags.value = parseTags(game.tags_json).join(", ");
				gameTtb.value = typeof game.time_to_beat_minutes === "number"
					? String((game.time_to_beat_minutes / 60).toFixed(1))
					: "";
				gamePlayed.value = game.played_month || "";
				gameModalError.classList.add("hidden");
				gameModalError.textContent = "";
				gameModal.showModal();
			}

			if (gameModal) {
				gameModal.addEventListener("click", (event) => {
					const target = event.target;
					if (!(target instanceof HTMLElement)) return;
					if (target.closest("[data-action='close-game']")) {
						gameModal.close();
					}
				});
				gameModal.addEventListener("submit", async (event) => {
					event.preventDefault();
					if (!activeGameId) return;
					const hoursValue = gameTtb.value ? Number.parseFloat(gameTtb.value) : null;
					if (hoursValue !== null && Number.isNaN(hoursValue)) {
						gameModalError.textContent = "Time to beat must be a number.";
						gameModalError.classList.remove("hidden");
						return;
					}
					if (!gameSubmitter.value) {
						gameModalError.textContent = "Submitter is required.";
						gameModalError.classList.remove("hidden");
						return;
					}
					const playedMonthValue = gamePlayed.value.trim();
					if (playedMonthValue && !/^\d{4}-\d{2}$/.test(playedMonthValue)) {
						gameModalError.textContent = "Played month must be YYYY-MM.";
						gameModalError.classList.remove("hidden");
						return;
					}
					const payload = {
						id: activeGameId,
						submitted_by_email: gameSubmitter.value,
						status: gameStatus.value,
						tags: gameTags.value,
						time_to_beat_hours: hoursValue,
						played_month: gamePlayed.value
					};
					const response = await fetch("/api/admin/games", {
						method: "PATCH",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify(payload)
					});
					if (response.ok) {
						gameModal.close();
						loadGames();
					} else {
						gameModalError.textContent = "Unable to update game.";
						gameModalError.classList.remove("hidden");
					}
				});
			}

			function getSortValue(row, key) {
				if (key === "title") return row.dataset.title || "";
				if (key === "submitter") return row.dataset.submitter || "";
				if (key === "status") return row.dataset.status || "";
				if (key === "tags") return row.dataset.tags || "";
				if (key === "ttb") return Number.parseInt(row.dataset.ttb || "0", 10);
				if (key === "played") return row.dataset.played || "";
				return "";
			}

			function sortGameRows(key, direction) {
				if (!gamesBody) return;
				const rows = Array.from(gamesBody.querySelectorAll(".clickable-row"));
				const dir = direction === "desc" ? -1 : 1;
				const sorted = rows.sort((a, b) => {
					const aValue = getSortValue(a, key);
					const bValue = getSortValue(b, key);
					if (typeof aValue === "number" && typeof bValue === "number") {
						const aScore = aValue || Number.MAX_SAFE_INTEGER;
						const bScore = bValue || Number.MAX_SAFE_INTEGER;
						return (aScore - bScore) * dir;
					}
					return String(aValue).localeCompare(String(bValue)) * dir;
				});
				sorted.forEach((row) => gamesBody.appendChild(row));
			}

			gameSortHeaders.forEach((header) => {
				header.addEventListener("click", () => {
					const key = header.dataset.sort;
					if (!key) return;
					const current = header.dataset.direction || "asc";
					const nextDirection = current === "asc" ? "desc" : "asc";
					gameSortHeaders.forEach((th) => {
						delete th.dataset.direction;
					});
					header.dataset.direction = nextDirection;
					sortGameRows(key, nextDirection);
				});
			});

			document.addEventListener("click", (event) => {
				const target = event.target;
				if (!(target instanceof HTMLElement)) return;
				const openInvite = target.closest("[data-action='open-invite']");
				if (openInvite && inviteModal) {
					inviteModal.showModal();
				}
				const closeInvite = target.closest("[data-action='close-invite']");
				if (closeInvite && inviteModal) {
					inviteModal.close();
				}
				const closeMember = target.closest("[data-action='close-member']");
				if (closeMember && memberModal) {
					memberModal.close();
				}
				const row = target.closest("tr[data-email]");
				if (row && memberModal) {
					const email = row.dataset.email;
					if (!email) return;
					openMemberModal(email);
				}
			});

			if (inviteForm) {
				inviteForm.addEventListener("submit", async (event) => {
					event.preventDefault();
					const formData = new FormData(inviteForm);
					const email = formData.get("email");
					const role = formData.get("role");
					const response = await fetch("/api/admin/members", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ email, role })
					});
					if (response.ok) {
						inviteForm.reset();
						if (inviteModal) inviteModal.close();
						loadMembers();
					}
				});
			}

			async function loadMembers() {
				if (!memberList) return;
				memberList.innerHTML = '<tr><td class="muted small" colspan="4">Loading members…</td></tr>';
				const response = await fetch("/api/admin/members");
				if (!response.ok) {
					memberList.innerHTML = '<tr><td class="muted small" colspan="4">Unable to load members.</td></tr>';
					return;
				}
				const members = await response.json();
				renderMembers(members);
			}

			function openMemberModal(email) {
				activeMember = email;
				const row = document.querySelector(`tr[data-email="${email}"]`);
				if (!row || !memberModal) return;
				const name = row.querySelector(".member-name")?.textContent || "Member";
				if (memberName) memberName.textContent = name;
				if (memberEmail) memberEmail.textContent = email;
				memberModal.showModal();
				loadMemberDetail(email);
			}

			async function loadMemberDetail(email) {
				const member = cachedMembers.find((item) => item.email === email);
				if (!member) return;
				if (editRole) editRole.value = member.role;
				if (editAlias) editAlias.value = member.alias || "";
				const isSelf = currentUserEmail && member.email === currentUserEmail;
				if (editRole) editRole.disabled = isSelf;
				const deleteButton = memberModal?.querySelector("[data-action='delete']");
				if (deleteButton) deleteButton.disabled = isSelf;
			}

			if (memberModal) {
				memberModal.addEventListener("submit", async (event) => {
					event.preventDefault();
					if (!activeMember) return;
					const isSelf = currentUserEmail && activeMember === currentUserEmail;
					const payload = {
						email: activeMember,
						alias: editAlias?.value || ""
					};
					if (!isSelf) {
						payload.role = editRole?.value || "member";
					}
					const response = await fetch("/api/admin/members", {
						method: "PATCH",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify(payload)
					});
					if (response.ok) {
						showToast("Member updated.");
						memberModal.close();
						loadMembers();
					} else {
						showToast("Unable to update member.", true);
					}
				});

				memberModal.addEventListener("click", async (event) => {
					const target = event.target;
					if (!(target instanceof HTMLElement)) return;
					const action = target.dataset.action;
					if (action === "delete" && activeMember) {
						const confirmed = window.confirm("Delete this member? This cannot be undone.");
						if (!confirmed) return;
						await fetch("/api/admin/members", {
							method: "DELETE",
							headers: { "Content-Type": "application/json" },
							body: JSON.stringify({ email: activeMember })
						});
						memberModal.close();
						loadMembers();
					}
				});
			}

			function showToast(message, isError = false) {
				const toast = document.querySelector(".toast");
				if (!toast) return;
				toast.textContent = message;
				toast.classList.toggle("is-error", isError);
				toast.classList.add("is-visible");
				setTimeout(() => {
					toast.classList.remove("is-visible");
				}, 2000);
			}
		</script>
	</body>
</html>

<style>
	:root {
		color-scheme: light;
		--ink: #1f2933;
		--muted: #5b6672;
		--tan: #dbe2ea;
		--ink-soft: #364152;
		--shadow: rgba(13, 30, 48, 0.18);
		--border: rgba(33, 51, 70, 0.14);
		--accent: #3b6ea5;
		--accent-dark: #2a5581;
		--radius: 22px;
		--glass: rgba(255, 255, 255, 0.7);
		--glass-strong: rgba(255, 255, 255, 0.88);
		font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
		background: radial-gradient(circle at top right, #f7fbff 0%, #eef2f6 55%, #e2e8f0 100%);
	}

	* {
		box-sizing: border-box;
	}

	body {
		margin: 0;
		color: var(--ink);
		background: linear-gradient(120deg, #f6f9fc 0%, #e9eff6 60%, #dde5ef 100%);
		min-height: 100vh;
	}

	main {
		display: grid;
		gap: 2rem;
	}

	.hero {
		display: grid;
		gap: 0;
		max-width: 520px;
	}

.hero .muted {
	max-width: 34rem;
}

	.members-card {
		max-width: 600px;
	}

	.invite-form {
		display: grid;
		gap: 1rem;
	}

	:global(.member-user) {
		display: inline-flex;
		align-items: center;
		gap: 0.6rem;
	}

	:global(.avatar) {
		width: 40px;
		height: 40px;
		border-radius: 50%;
		background: rgba(59, 110, 165, 0.18);
		display: grid;
		place-items: center;
		font-weight: 700;
		color: var(--ink-soft);
		overflow: hidden;
	}

	:global(.avatar-img) {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}

	:global(.avatar-fallback) {
		display: grid;
		place-items: center;
		width: 100%;
		height: 100%;
	}

		:global(.toast) {
			margin-bottom: 0;
		padding: 0.4rem 0.8rem;
		border-radius: 999px;
		font-size: 0.8rem;
		background: rgba(43, 177, 120, 0.2);
		color: #1b6346;
		border: 1px solid rgba(43, 177, 120, 0.4);
		display: inline-flex;
		align-items: center;
		gap: 0.4rem;
		opacity: 0;
		transform: translateY(-4px);
		transition: opacity 0.2s ease, transform 0.2s ease;
	}

		:global(.toast.is-visible) {
			opacity: 1;
			transform: translateY(0);
			margin-bottom: 0.6rem;
		}

	:global(.toast.is-error) {
		background: rgba(200, 90, 90, 0.18);
		color: #8a2f2f;
		border-color: rgba(200, 90, 90, 0.4);
	}

	.member-name {
		font-weight: 600;
	}

	.member-email {
		color: var(--muted);
		font-size: 0.82rem;
	}

		.small-button {
			padding: 0.4rem 0.7rem;
			font-size: 0.75rem;
		}

	.ghost.danger {
		border-color: rgba(200, 90, 90, 0.5);
		color: #8a2f2f;
	}

		.invite-cta {
			width: fit-content;
		}

	@media (max-width: 900px) {
		.invite-form {
			grid-template-columns: 1fr;
		}

		.actions {
			flex-direction: column;
			align-items: flex-start;
		}
	}

	.is-hidden {
		display: none;
	}

</style>
